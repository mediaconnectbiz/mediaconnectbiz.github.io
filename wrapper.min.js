function startPlayer(){var keys={};if(flashvars.split("&").forEach(function(item){item=item.split("="),keys[item[0]]=item[1]}),videos=keys.video?keys.video.split(","):[],keys.start){var ind=videos.indexOf(keys.start);currentViewIndex=ind!=-1?ind:0}keys.autoplay&&(autoplay=!0),initPlayPostmessage(),keys.dl&&(pageUrl=keys.dl),keys.pl&&(pl=keys.pl),keys.datauri&&(outURL=decodeURIComponent(keys.datauri));var m;try{m=window._mode||""}catch(err){m=""}if(console.log("m:",m),"flash"===m){try{tFlashInstalled="undefined"!=typeof navigator.plugins&&"object"==typeof navigator.plugins["Shockwave Flash"]||window.ActiveXObject&&0!=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(err){tFlashInstalled=!1}if(tFlashInstalled)return flashvars=updVar(flashvars,"target","web"),void initFlash()}isMobile()?(flashvars=updVar(flashvars,"type","html5"),flashvars=updVar(flashvars,"target","mobile")):(flashvars=updVar(flashvars,"type","html5"),flashvars=updVar(flashvars,"target","web-html5")),initHTML5()}function initPlayPostmessage(){if("function"==typeof window.changeVideoState){changeVideoState(-1);var ParentWindow=window;ParentWindow.addEventListener("message",startVideoPostmessage)}}function startVideoPostmessage(event){try{var message=JSON.parse(event.data)}catch(err){return}switch(message.type){case"player:play":if(!autoplay){var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),tPlayer.dispatchEvent(evt)}break;case"player:changeVideo":var data=message.data;console.log("player:changeVideo",data.id),flashvars=updVar(flashvars,"videoid",data.id),videos.indexOf(data.id)>-1?showVideo(videos.indexOf(data.id)):(viedeos=[data.id],showVideo(0))}}function removeEventStartVideoPostmessage(){var ParentWindow=window;ParentWindow.removeEventListener("message",startVideoPostmessage)}function getXmlHttp(){var xmlhttp;try{xmlhttp=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}catch(E){xmlhttp=!1}}return xmlhttp||"undefined"==typeof XMLHttpRequest||(xmlhttp=new XMLHttpRequest),xmlhttp}function getVideo(videoId){var xmlhttp=getXmlHttp();if(flashvars=updVar(flashvars,"videoid",videoId),xmlhttp.open("GET",outURL+"/getVideo?"+flashvars,!1),xmlhttp.send(null),200==xmlhttp.status){var dp=new DOMParser,xDoc=dp.parseFromString(xmlhttp.responseText,"text/xml"),obj={};return obj.title=xDoc.getElementsByTagName("fulltitle")[0].textContent.trim(),obj.poster=xDoc.getElementsByTagName("cover")[0].textContent.trim(),obj}return{}}function clearStartScreen(){for(;tPlayer.firstChild;)tPlayer.removeChild(tPlayer.firstChild);tPlayer.style.backgroundImage="",document.getElementById("body").className=""}function showStartScreen(title,poster){document.getElementById("body").className="html5";var label=cEl("span","label",title),playbtn=cEl("div","playbtn",!1);appender(tPlayer,[label,playbtn]),tPlayer.style.backgroundImage="url('"+poster+"')"}function showVideo(index){console.log("showVideo",index),player.updateVideo()}function initHTML5(){clearStartScreen(),showStartScreen(title,poster);var keys={};flashvars.split("&").forEach(function(item){item=item.split("="),keys[item[0]]=item[1]}),flashvars=updVar(flashvars,"videoid",keys.video.split(",")[currentViewIndex]);var startvideo=function(){tPlayer.removeEventListener("click",startvideo),clearStartScreen(),player.loadPlayer()}.bind(this),playerLoadComplete=function(){var handler=function(){tPlayer.removeEventListener("click",handler.bind(this)),clearStartScreen(),player.play()};isMobile()?(player.dispatcher.addEventListener("PLADFORM_PLAYER_READY",function(){tPlayer.addEventListener("click",handler.bind(this))}.bind(this)),player.loadPlayer()):autoplay?startvideo():tPlayer.addEventListener("click",startvideo);var nextVideo=function(){currentViewIndex++;var messageErrr="ups";try{throw new Error("hi")}catch(err){messageErrr=err.stack}if(currentViewIndex<videos.length)flashvars=updVar(flashvars,"videoid",keys.video.split(",")[currentViewIndex]),showVideo(currentViewIndex);else{var oo=getVideo(keys.video.split(",")[0]);showStartScreen(oo.title,oo.poster);var vv=function(){tPlayer.removeEventListener("click",vv),clearStartScreen(),currentViewIndex=0,flashvars=updVar(flashvars,"videoid",keys.video.split(",")[currentViewIndex]),showVideo(currentViewIndex)}.bind(this);tPlayer.addEventListener("click",vv)}}.bind(this);player.dispatcher.addEventListener("PLADFORM_VIDEO_COMPLETE",nextVideo),"function"==typeof window.changeVideoState&&changeVideoState(0)};scriptTag(_locattion+"js/pplayer.js?rnd="+Math.floor(999999*Math.random()),playerLoadComplete.bind(this))}function videoCompleteHandler(e){_player.clear(),currentViewIndex++,currentViewIndex<videos.length?(autoplay=!0,initHTML5()):(autoplay=!1,currentViewIndex=0,initHTML5())}function cEl(_el,_class,inner){var _res=document.createElement(_el);return inner&&(_res.innerHTML=inner),_res.className=_class,_res}function appender(_el,arr){for(var i=0;i<arr.length;i++)_el.appendChild(arr[i])}function initFlash(){clearStartScreen(),console.log("initFlash",autoplay),document.getElementById("body").className="flash";var label=cEl("span","label",title),playbtn=cEl("div","playbtn",!1),warn=cEl("div","warn",!1),spinner=cEl("div","spinner",!1);appender(tPlayer,[label,playbtn,warn,spinner]),tPlayer.style.backgroundImage="url('"+poster+"')";var tIsStartClick=!0;autoplay?tIsStartClick&&(tIsStartClick=!1,setPlayer()):tPlayer.addEventListener("click",function(){tIsStartClick&&(tIsStartClick=!1,setPlayer())})}function playerComplete(){var ar=flashvars.split("&"),newar=[];ar.forEach(function(item){var ai=item.split("=");"start"!=ai[0]&&newar.push(item)}),flashvars=newar.join("&"),getStartScreen(),autoplay=!1,tPlayer.addEventListener("click",setPlayer)}function getStartScreen(){tPlayer.innerHTML="",document.getElementById("body").className="flash";var vInfo=getVideo(keys.video.split(",")[0]),label=cEl("span","label",vInfo.title),playbtn=cEl("div","playbtn",!1);appender(tPlayer,[label,playbtn]),tPlayer.style.backgroundImage="url('"+vInfo.poster+"')"}function updVar(urlStr,varName,varValue){var ar=urlStr.split("&"),newar=[],isContain=!1;return ar.forEach(function(item){var ai=item.split("=");ai.length>1&&ai[0]==varName&&(ai[1]=varValue,item=ai.join("="),isContain=!0),newar.push(item)}),isContain||newar.push(varName+"="+varValue),newar.join("&")}function setPlayer(){if(console.log("setPlayer",tFlashInstalled),tFlashInstalled){var tEmbed='<object id="FlashPlayer" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,2,0,0" width="100%" height="100%">';tEmbed+='<param name="movie" value="//static.pladform.ru/iplayer.swf">',tEmbed+='<param name="wmode" value="opaque">',tEmbed+='<param name="allowscriptaccess" value="always">',tEmbed+='<param name="allowfullscreen" value="true">',tEmbed+='<param name="bgcolor" value="#000000">',tEmbed+='<param name="flashvars" value="'+flashvars+'">',tEmbed+='<embed name="FlashPlayer" pluginspage="//www.adobe.com/go/getflashplayer" src="//static.pladform.ru/iplayer.swf" width="100%" height="100%" wmode="opaque" allowscriptaccess="always" allowfullscreen="true" bgcolor="#000000" flashvars="'+flashvars+'"></embed>',tEmbed+="</object>",tPlayer.innerHTML=tEmbed,setTimeout(function(){if(autoplay){var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),tPlayer.dispatchEvent(evt)}},100)}}function scriptTag(src,callback){var s=document.createElement("script");s.type="text/"+(src.type||"javascript"),s.src=src.src||src,s.async=!1,s.onreadystatechange=s.onload=function(){var state=s.readyState;!callback||callback.done||state&&!/loaded|complete/.test(state)||(callback.done=!0,callback())},(document.body||document.head).appendChild(s)}function CSSLoad(file){var link=document.createElement("link");link.setAttribute("rel","stylesheet"),link.setAttribute("type","text/css"),link.setAttribute("href",file),document.getElementsByTagName("head")[0].appendChild(link)}function isMobile(){var check=!1;return function(a){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))&&(check=!0)}(window.navigator.userAgent||window.navigator.vendor||window.opera),check}var videos=[],currentViewIndex=0,autoplay=!1,outURL="//out.pladform.ru",tFlashInstalled=!1,pl,pageUrl;